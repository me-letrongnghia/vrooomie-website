<div class="user-detail-container">
  <div class="content-wrapper">
    <!-- Sidebar Menu -->
    <div class="sidebar">
      <div class="menu-list">
        <h1>Xin ch√†o b·∫°n!</h1>

        <div class="menu-item" [class.active]="activeMenu === 'account'" (click)="onMenuClick('account')">
          <span class="menu-icon"><i class="fa-regular fa-user"></i></span>
          <span class="menu-label">T√†i kho·∫£n c·ªßa t√¥i</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'favorites'" (click)="onMenuClick('favorites')">
          <span class="menu-icon"><i class="fa-regular fa-heart"></i></span>
          <span class="menu-label">Xe y√™u th√≠ch</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'my-cars'" (click)="onMenuClick('my-cars')">
          <span class="menu-icon"><i class="fa-solid fa-car"></i></span>
          <span class="menu-label">Xe c·ªßa t√¥i</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'my-trips'" (click)="onMenuClick('my-trips')">
          <span class="menu-icon"><i class="fa-solid fa-road"></i></span>
          <span class="menu-label">Chuy·∫øn c·ªßa t√¥i</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'long-term-rental'"
          (click)="onMenuClick('long-term-rental')">
          <span class="menu-icon"><i class="fa-solid fa-file-invoice"></i></span>
          <span class="menu-label">Thu√™ xe d√†i h·∫°n</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'gifts'" (click)="onMenuClick('gifts')">
          <span class="menu-icon"><i class="fa-solid fa-gift"></i></span>
          <span class="menu-label">Qu√† t·∫∑ng</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'addresses'" (click)="onMenuClick('addresses')">
          <span class="menu-icon"><i class="fa-solid fa-location-dot"></i></span>
          <span class="menu-label">ƒê·ªãa ch·ªâ c·ªßa t√¥i</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'change-password'"
          (click)="onMenuClick('change-password')">
          <span class="menu-icon"><i class="fa-solid fa-lock"></i></span>
          <span class="menu-label">ƒê·ªïi m·∫≠t kh·∫©u</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'delete-account'" (click)="onMenuClick('delete-account')">
          <span class="menu-icon"><i class="fa-solid fa-trash"></i></span>
          <span class="menu-label">Y√™u c·∫ßu x√≥a t√†i kho·∫£n</span>
        </div>

        <div class="menu-item" [class.active]="activeMenu === 'logout'" (click)="onMenuClick('logout')">
          <span class="menu-icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></span>
          <span class="menu-label">ƒêƒÉng xu·∫•t</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">

      <!-- T√†i kho·∫£n c·ªßa t√¥i Content -->
      <div *ngIf="activeMenu === 'account'" class="content-section">
        
        <!-- Authentication Loading State -->
        <div *ngIf="isAuthLoading" class="loading-container">
          <div class="dots-loader">
            <span></span><span></span><span></span>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="error && !loading && !isAuthLoading" class="error-container">
          <div class="error-message">
            <i class="fa-solid fa-exclamation-triangle"></i>
            <h3>C√≥ l·ªói x·∫£y ra</h3>
            <p>{{ error }}</p>
            <button class="primary-btn" (click)="loadUserDetail()">Th·ª≠ l·∫°i</button>
          </div>
        </div>

        <!-- User Profile Section -->
        <div *ngIf="userDetail && !loading && !error && !isAuthLoading" class="user-profile">
          <div class="avatar-section">
            <img [src]="getAvatarUrl()" [alt]="userDetail?.avatarUrl" class="user-avatar">
            <div class="user-basic-info">
              <h2 class="user-name">{{ userDetail?.fullName }}</h2>
              <p class="join-date">Tham gia: {{ formatJoinDate(userDetail?.createdAt) }}</p>
              <div class="points-badge">
                <span class="crown-icon">üëë</span>
                <span>{{ userDetail?.points }} ƒëi·ªÉm</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Personal Information Section -->
        <div *ngIf="userDetail && !loading && !error && !isAuthLoading" class="personal-info">
          <div class="info-row">
            <span class="info-label">Ng√†y sinh</span>
            <span class="info-value">{{ formatBirthDate(userDetail?.birthDate) }}</span>
          </div>

          <div class="info-row">
            <span class="info-label">Gi·ªõi t√≠nh</span>
            <span class="info-value">{{ userDetail?.gender }}</span>
          </div>

          <div class="info-row">
            <span class="info-label">S·ªë ƒëi·ªán tho·∫°i</span>
            <div class="info-value-with-action">
              <span *ngIf="!userDetail?.phoneNumber" class="verification-badge unverified">Ch∆∞a x√°c th·ª±c</span>
              <span class="info-value">{{ userDetail?.phoneNumber }}</span>
              <button class="edit-btn small" (click)="onEditPhone()">‚úèÔ∏è</button>
            </div>
          </div>

          <div class="info-row">
            <span class="info-label">Email</span>
            <div class="info-value-with-action">
              <span *ngIf="!userDetail?.email" class="verification-badge unverified">Ch∆∞a x√°c th·ª±c</span>
              <span *ngIf="userDetail?.email" class="info-value">{{ userDetail?.email }}</span>
              <span *ngIf="!userDetail?.email" class="info-value add-link" (click)="onAddEmail()">Th√™m email</span>
              <button class="edit-btn small" (click)="onAddEmail()">‚úèÔ∏è</button>
            </div>
          </div>

          <div class="info-row">
            <span class="info-label">Facebook</span>
            <div class="info-value-with-action">
              <span class="info-value add-link" (click)="onAddFacebook()">Th√™m li√™n k·∫øt</span>
              <button class="edit-btn small" (click)="onAddFacebook()">‚úèÔ∏è</button>
            </div>
          </div>

          <div class="info-row">
            <span class="info-label">Google</span>
            <div class="info-value-with-action">
              <span class="info-value add-link" (click)="onAddGoogle()">Th√™m li√™n k·∫øt</span>
              <button class="edit-btn small" (click)="onAddGoogle()">‚úèÔ∏è</button>
            </div>
          </div>
        </div>

        <!-- Driver License Section -->
        <!-- <div class="driver-license-section">
          <div class="license-header">
            <span class="license-title">Gi·∫•y ph√©p l√°i xe</span>
            <span class="license-status unverified">{{ userInfo.driverLicense.status }}</span>
            <button class="edit-btn" (click)="onEditDriverLicense()">Ch·ªânh s·ª≠a</button>
          </div>
        </div> -->

        <!-- Warning Notice -->
        <div *ngIf="userDetail && !loading && !error && !isAuthLoading" class="warning-notice">
          <p><strong>L∆∞u √Ω:</strong> ƒë·ªÉ tr√°nh ph·∫°t sinh v·∫≠n ƒë·ªÉ trong qu√° tr√¨nh thu√™ xe,
            <strong>ng∆∞·ªùi ƒë·∫∑t xe</strong> tr√™n Mioto (ƒë√£ x√°c th·ª±c GPLX)
            <strong>ƒê·ªíNG TH·ªúI</strong> ph·∫£i l√† <strong>ng∆∞·ªùi nh·∫≠n xe</strong>.
          </p>
        </div>
      </div>

      <!-- Xe y√™u th√≠ch Content -->
      <div *ngIf="activeMenu === 'favorites'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-regular fa-heart"></i> Xe y√™u th√≠ch</h2>
          <p>Danh s√°ch xe b·∫°n ƒë√£ y√™u th√≠ch</p>
        </div>
        <div class="empty-state">
          <i class="fa-regular fa-heart empty-icon"></i>
          <p>B·∫°n ch∆∞a c√≥ xe y√™u th√≠ch n√†o</p>
          <p>H√£y kh√°m ph√° v√† th√™m nh·ªØng chi·∫øc xe b·∫°n th√≠ch v√†o danh s√°ch!</p>
        </div>
      </div>

      <!-- Xe c·ªßa t√¥i Content -->
      <div *ngIf="activeMenu === 'my-cars'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-car"></i> Xe c·ªßa t√¥i</h2>
          <p>Qu·∫£n l√Ω danh s√°ch xe c·ªßa b·∫°n</p>
          <button class="primary-btn add-car-btn">
            <i class="fa-solid fa-plus"></i>
            ƒêƒÉng k√Ω xe m·ªõi
          </button>
        </div>

        <!-- Loading State -->
        <div *ngIf="carsLoading" class="loading-container">
          <div class="dots-loader">
            <span></span><span></span><span></span>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="carsError && !carsLoading" class="error-container">
          <div class="error-message">
            <i class="fa-solid fa-exclamation-triangle"></i>
            <h3>C√≥ l·ªói x·∫£y ra</h3>
            <p>{{ carsError }}</p>
            <button class="primary-btn" (click)="loadUserCars()">Th·ª≠ l·∫°i</button>
          </div>
        </div>

        <!-- Cars List -->
        <div *ngIf="!carsLoading && !carsError && userCars.length > 0" class="cars-list">
          <div *ngFor="let car of userCars" class="car-item">
            <div class="car-image">
              <img [src]="car.imageUrl" [alt]="car.brand + ' ' + car.model" />
              <div class="car-status" [ngClass]="getStatusClass(car.status)">
                {{ getStatusText(car.status) }}
              </div>
            </div>
            <div class="car-info">
              <div class="car-header">
                <h3 class="car-title">{{ car.brand }} {{ car.model }}</h3>
                <div class="car-actions">
                  <button class="action-btn view-btn" (click)="onViewCar(car.id)" title="Xem chi ti·∫øt">
                    <i class="fa-solid fa-eye"></i>
                  </button>
                  <button class="action-btn edit-btn" (click)="onEditCar(car.id)" title="Ch·ªânh s·ª≠a">
                    <i class="fa-solid fa-edit"></i>
                  </button>
                  <button class="action-btn delete-btn" (click)="onDeleteCar(car.id)" title="X√≥a">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </div>
              <div class="car-details">
                <span class="car-detail-item">
                  <i class="fa-solid fa-car"></i>
                  {{ car.type }}
                </span>
                <span class="car-detail-item">
                  <i class="fa-solid fa-location-dot"></i>
                  {{ car.address }}
                </span>
                <span class="car-detail-item">
                  <i class="fa-solid fa-ticket"></i>
                  {{ car.licensePlate }}
                </span>
              </div>
              <div class="car-price">
                <span class="price-amount">{{ formatPrice(car.pricePerDay) }}K</span>
                <span class="price-unit">/ng√†y</span>
              </div>
              <div class="car-description" *ngIf="car.description">
                <p>{{ car.description }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!carsLoading && !carsError && userCars.length === 0" class="empty-state">
          <i class="fa-solid fa-car empty-icon"></i>
          <p>B·∫°n ch∆∞a c√≥ xe n√†o</p>
          <p>ƒêƒÉng k√Ω xe c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu cho thu√™!</p>
          <button class="primary-btn">ƒêƒÉng k√Ω xe</button>
        </div>
      </div>

      <!-- Chuy·∫øn c·ªßa t√¥i Content -->
      <div *ngIf="activeMenu === 'my-trips'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-road"></i> Chuy·∫øn c·ªßa t√¥i</h2>
          <p>L·ªãch s·ª≠ c√°c chuy·∫øn ƒëi c·ªßa b·∫°n</p>
        </div>
        <div class="empty-state">
          <i class="fa-solid fa-road empty-icon"></i>
          <p>B·∫°n ch∆∞a c√≥ chuy·∫øn ƒëi n√†o</p>
          <p>H√£y thu√™ xe v√† b·∫Øt ƒë·∫ßu cu·ªôc phi√™u l∆∞u c·ªßa b·∫°n!</p>
          <button class="primary-btn">T√¨m xe</button>
        </div>
      </div>

      <!-- ƒê∆°n h√†ng Thu√™ xe d√†i h·∫°n Content -->
      <div *ngIf="activeMenu === 'long-term-rental'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-file-invoice"></i>Thu√™ xe d√†i h·∫°n</h2>
          <p>Qu·∫£n l√Ω c√°c xe thu√™ d√†i h·∫°n</p>
        </div>
        <div class="empty-state">
          <i class="fa-solid fa-file-invoice empty-icon"></i>
          <p>B·∫°n ch∆∞a c√≥ xe thu√™ d√†i h·∫°n n√†o</p>
          <p>Thu√™ xe d√†i h·∫°n ƒë·ªÉ c√≥ gi√° t·ªët h∆°n cho chuy·∫øn ƒëi d√†i ng√†y!</p>
        </div>
      </div>

      <!-- Qu√† t·∫∑ng Content -->
      <div *ngIf="activeMenu === 'gifts'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-gift"></i> Qu√† t·∫∑ng</h2>
          <p>Voucher v√† qu√† t·∫∑ng d√†nh cho b·∫°n</p>
        </div>
        <div class="empty-state">
          <i class="fa-solid fa-gift empty-icon"></i>
          <p>B·∫°n ch∆∞a c√≥ qu√† t·∫∑ng n√†o</p>
          <p>Tham gia c√°c ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i ƒë·ªÉ nh·∫≠n qu√† t·∫∑ng!</p>
        </div>
      </div>

      <!-- ƒê·ªãa ch·ªâ c·ªßa t√¥i Content -->
      <div *ngIf="activeMenu === 'addresses'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-location-dot"></i> ƒê·ªãa ch·ªâ c·ªßa t√¥i</h2>
          <p>Qu·∫£n l√Ω c√°c ƒë·ªãa ch·ªâ giao nh·∫≠n xe</p>
        </div>
        <div class="empty-state">
          <i class="fa-solid fa-location-dot empty-icon"></i>
          <p>B·∫°n ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o</p>
          <p>Th√™m ƒë·ªãa ch·ªâ ƒë·ªÉ thu√™ xe d·ªÖ d√†ng h∆°n!</p>
          <button class="primary-btn">Th√™m ƒë·ªãa ch·ªâ</button>
        </div>
      </div>

      <!-- ƒê·ªïi m·∫≠t kh·∫©u Content -->
      <div *ngIf="activeMenu === 'change-password'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-lock"></i> ƒê·ªïi m·∫≠t kh·∫©u</h2>
          <p>Thay ƒë·ªïi m·∫≠t kh·∫©u t√†i kho·∫£n c·ªßa b·∫°n</p>
        </div>
        <div class="form-container">
          <div class="form-group">
            <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
            <input type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
          </div>
          <div class="form-group">
            <label>M·∫≠t kh·∫©u m·ªõi</label>
            <input type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
          </div>
          <div class="form-group">
            <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
            <input type="password" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
          </div>
          <button class="primary-btn">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
        </div>
      </div>

      <!-- Y√™u c·∫ßu x√≥a t√†i kho·∫£n Content -->
      <div *ngIf="activeMenu === 'delete-account'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-trash"></i> Y√™u c·∫ßu x√≥a t√†i kho·∫£n</h2>
          <p>X√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n c·ªßa b·∫°n</p>
        </div>
        <div class="warning-box">
          <i class="fa-solid fa-exclamation-triangle"></i>
          <h3>C·∫£nh b√°o!</h3>
          <p>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c. T·∫•t c·∫£ d·ªØ li·ªáu c·ªßa b·∫°n s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn.</p>
          <button class="danger-btn">X√≥a t√†i kho·∫£n</button>
        </div>
      </div>

      <!-- ƒêƒÉng xu·∫•t Content -->
      <div *ngIf="activeMenu === 'logout'" class="content-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-arrow-right-from-bracket"></i> ƒêƒÉng xu·∫•t</h2>
          <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?</p>
        </div>
        <div class="logout-confirmation">
          <p>B·∫°n s·∫Ω c·∫ßn ƒëƒÉng nh·∫≠p l·∫°i ƒë·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª•.</p>
          <div class="button-group">
            <button class="danger-btn" (click)="onLogout()">ƒêƒÉng xu·∫•t</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>